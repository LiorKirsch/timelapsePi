<html>
<head>
<title> timelapse </title>
<link rel="stylesheet" href="index.css">
</head>

<body>

<br>
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script>
    function sendPostSignal(url, postData,onSuccess) {
			$.ajax({
	        type: "POST",
	        //the url where you want to sent the userName and password to
	        url: url,
	        dataType: 'json',
	        async: false,
	        //json object to sent to the authentication url
	        data: postData,
	        success: onSuccess  
    		});
    }
    function checkStatus() {
    		$.post('./active', null,
    				function (dataReceive) {
				        if (dataReceive.active) {
				  			$('#status').html(dataReceive.message + ' last image on ' + dataReceive.params.lastPictureTime);
				  			var seconds = dataReceive.params.seconds;
				  			var hours = Math.floor(seconds / 3600);
				  			seconds = seconds % 3600;
				  			var minutes = Math.floor(seconds / 60);
				  			seconds = seconds % 60;
				  			$('#secondsField').val(seconds).prop('disabled', true);
				  			$('#minutesField').val(minutes).prop('disabled', true);
				  			$('#hoursField').val(hours).prop('disabled', true);
				  			$('#widthField').prop('disabled', true);
				  			$('#heightField').prop('disabled', true);
				  			$('#project').val(dataReceive.params.project).prop('disabled', true);
				  			
				  			$('#samplePic').attr("src","./samplePic.jpeg?" + new Date().getTime() );
				  		}
				  		else {
				  			$('#status').html(dataReceive.message);
				  			$('#secondsField').prop('disabled', false);
				  			$('#minutesField').prop('disabled', false);
				  			$('#hoursField').prop('disabled', false);
				  			$('#widthField').prop('disabled', false);
				  			$('#heightField').prop('disabled', false);
				  			$('#project').prop('disabled', false);
				  		}
	    			});
            };
    function takePic(){
    	$.post('./samplePic', null,
    				function (dataReceive) {
    					$('#samplePic').attr("src","./samplePic.jpeg?" + new Date().getTime() );
	    			});
            };
    function stopTimeLapse(){
    	$.post('./stop', 
    				function (dataReceive) {
    					$('#status').html('stopping');;
	    			});
            }; 
            
    function makeMovie(){
    	$('#createMoviePreLoader').show();
    	$('#movieLink').hide();
       	var dataToSend = { 'project': $('#project').val(), 'imageWidth':  $('#widthField').val(), 'imageHeight' : $('#heightField').val(), 'fps' :$('#fps').val()}
    	$.post('./createMovie', dataToSend,
    				function (dataReceive) {
    					$('#createMoviePreLoader').hide();
    					$('#movieLink').attr("href",dataReceive.movieFileName);
    					$('#movieLink').show();
	    			});
            };
         
    function startTimeLapse(){
    	var seconds = parseFloat($('#hoursField').val()) * 3600 + parseFloat($('#minutesField').val())*60 + parseFloat($('#secondsField').val());
    	var dataToSend = {'seconds':seconds, 'project': $('#project').val(), 'imageWidth':  $('#widthField').val(), 'imageHeight' : $('#heightField').val()}
    	$.post('./start', dataToSend,
    				function (dataReceive) {
    					$('#status').html('starting timelapse');
	    			});
            };      
            
    checkStatus();
    window.setInterval(function(){
	   checkStatus();
	}, 5000);
		 
    </script>
    
    
		Take a picture every: <input type="text" id="hoursField"  value="0" size='4'>:
		<input type="text" id="minutesField"  value="0" size='4'>:
		<input type="text" id='secondsField' value="30" size='4'>    (Hours : Minutes : Seconds)<br>
  		Resolution: <input type="text" id="widthField"  value="1280" size='4'> x <input type="text" id="heightField"  value="720" size='4'> <br>
		Project name: <input type="text" id="project" id='projectField' value="my time lapse"><br>
  		<input type="button" id='starTimeLapseButton' onclick="startTimeLapse();" value="Start timelapse" />
  		
	<br>
		
	<input type="button" id='stopTimeLapseButton' onclick="stopTimeLapse();" value="click to stop the timelapse" />
	
	<form action="./active" method="POST">
  		<input type="submit" value="click for status">
	</form>
	
	<input type="button" id='takePicButton' onclick="takePic();" value="click to take pic" />
	
	<span id='status'> </span> 
	<br>
	Frames per second: <input type="text" id='fps' value="20" size='3'>
	<input type="button" id='makeMovie' onclick="makeMovie();" value="click to create the movie" /> <img src='pageLoadPreloader.gif' id='createMoviePreLoader'><a id='movieLink' > movie </a>
	<br>
	<img src='./samplePic.jpeg' id='samplePic'> </img>
</body>
</html>

